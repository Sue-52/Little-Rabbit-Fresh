## 首页模块

### 1. 顶部通栏布局

思路：

- [x] 引用字体图标库, 顶部通栏中的图标都是字体图标
- [x] 创建顶部通栏组件 `AppTopNav`, 实现基础布局
- [x] 根据登录状态切换显示用户名和登录按钮

------

第一步：在 `public/index.html` 引入字体图标

~~~html
<link rel="stylesheet" href="//at.alicdn.com/t/font_2143783_iq6z4ey5vu.css">
~~~

第二步：书写`components/AppTopNav.vue`布局样式

~~~vue
<template>
  <nav class="app-top-nav">
    <div class="container">
      <ul>
        <li>
          <a href="javascript:"><i class="iconfont icon-user"></i>周杰伦</a>
        </li>
        <li><a href="javascript:">退出登录</a></li>
        <li><a href="javascript:">请先登录</a></li>
        <li><a href="javascript:">免费注册</a></li>
        <li><a href="javascript:">我的订单</a></li>
        <li><a href="javascript:">会员中心</a></li>
        <li><a href="javascript:">帮助中心</a></li>
        <li><a href="javascript:">关于我们</a></li>
        <li>
          <a href="javascript:"><i class="iconfont icon-phone"></i>手机版</a>
        </li>
      </ul>
    </div>
  </nav>
</template>

<script>
export default {
  name: "AppTopNav",
};
</script>

<style scoped lang="less">
.app-top-nav {
  background: #333;
  ul {
    display: flex;
    height: 53px;
    justify-content: flex-end;
    align-items: center;
    li {
      a {
        padding: 0 15px;
        color: #cdcdcd;
        line-height: 1;
        display: inline-block;
        i {
          font-size: 14px;
          margin-right: 2px;
        }
        &:hover {
          color: @xtxColor;
        }
      }
      ~ li {
        a {
          border-left: 2px solid #666;
        }
      }
    }
  }
}
</style>
~~~

第三步：根据当前登录状态切换显示用户名和退出登录

~~~vue
<template>
<!-- 判断用户是否登录，判断是否携带了Token -->
<template v-if="user.profile.token">
  <li>
    <a href="javascript:"
      ><i class="iconfont icon-user"></i>{{ user.profile.accont }}</a
    >
  </li>
  <li><a href="javascript:">退出登录</a></li>
</template>
<template v-else>
  <li><a href="javascript:">请先登录</a></li>
  <li><a href="javascript:">免费注册</a></li>
</template>
</template>

<script>
import { useStore } from "vuex";

export default {
  name: "AppTopNav",
  setup() {
    const store = useStore();
    const user = store.state.user;
    return {
      user,
    };
  },
};
</script>
~~~

### 2. 头部布局

在`component/AppHeader.vue` 书写布局样式

~~~vue
<template>
  <header class="app-header">
    <div class="container">
      <h1 class="logo"><RouterLink to="/"></RouterLink></h1>
      <ul class="app-header-nav">
        <li class="home">
          <RouterLink to="/">首页</RouterLink>
        </li>
        <li><a href="#">美食</a></li>
        <li><a href="#">餐厨</a></li>
        <li><a href="#">艺术</a></li>
        <li><a href="#">电器</a></li>
        <li><a href="#">居家</a></li>
        <li><a href="#">洗护</a></li>
        <li><a href="#">孕婴</a></li>
        <li><a href="#">服装</a></li>
        <li><a href="#">杂货</a></li>
      </ul>
      <div class="search">
        <i class="iconfont icon-search"></i>
        <input type="text" placeholder="搜一搜" />
      </div>
      <div class="cart">
        <a class="curr" href="#">
          <i class="iconfont icon-cart"></i><em>2</em>
        </a>
      </div>
    </div>
  </header>
</template>

<script>
export default {
  name: "AppHeader",
};
</script>

<style scoped lang="less">
.app-header {
  background: #fff;
  .container {
    display: flex;
    align-items: center;
  }
  .logo {
    width: 200px;
    a {
      display: block;
      height: 132px;
      width: 100%;
      text-indent: -9999px;
      background: url(../assets/images/logo.png) no-repeat center 18px / contain;
    }
  }
  .app-header-nav {
    width: 820px;
    display: flex;
    justify-content: space-around;
    padding-left: 40px;
    position: relative;
    z-index: 998;

    > li {
      margin-right: 40px;
      width: 38px;
      text-align: center;

      > a {
        font-size: 16px;
        line-height: 32px;
        height: 32px;
        display: inline-block;
      }

      &:hover {
        > a {
          color: @xtxColor;
          border-bottom: 1px solid @xtxColor;
        }

        > .layer {
          height: 132px;
          opacity: 1;
        }
      }
    }
  }
  .search {
    width: 170px;
    height: 32px;
    position: relative;
    border-bottom: 1px solid #e7e7e7;
    line-height: 32px;
    .icon-search {
      font-size: 18px;
      margin-left: 5px;
    }
    input {
      width: 140px;
      padding-left: 5px;
      color: #666;
    }
  }
  .cart {
    width: 50px;
    .curr {
      height: 32px;
      line-height: 32px;
      text-align: center;
      position: relative;
      display: block;
      .icon-cart {
        font-size: 22px;
      }
      em {
        font-style: normal;
        position: absolute;
        right: 0;
        top: 0;
        padding: 1px 6px;
        line-height: 1;
        background: @helpColor;
        color: #fff;
        font-size: 12px;
        border-radius: 10px;
        font-family: Arail, serif;
      }
    }
  }
}
</style>
~~~

### 3. 底部布局

在 `component/AppFooter.vue` 书写布局样式

~~~vue
<template>
  <footer class="app-footer">
    <!-- 联系我们 -->
    <div class="contact">
      <div class="container">
        <dl>
          <dt>客户服务</dt>
          <dd><i class="iconfont icon-kefu"></i> 在线客服</dd>
          <dd><i class="iconfont icon-question"></i> 问题反馈</dd>
        </dl>
        <dl>
          <dt>关注我们</dt>
          <dd><i class="iconfont icon-weixin"></i> 公众号</dd>
          <dd><i class="iconfont icon-weibo"></i> 微博</dd>
        </dl>
        <dl>
          <dt>下载APP</dt>
          <dd class="qrcode">
            <img src="../assets/images/qrcode.jpg" alt="" />
          </dd>
          <dd class="download">
            <span>扫描二维码</span>
            <span>立马下载APP</span>
            <a href="javascript:">下载页面</a>
          </dd>
        </dl>
        <dl>
          <dt>服务热线</dt>
          <dd class="hotline">
            400-0000-000 <small>周一至周日 8:00-18:00</small>
          </dd>
        </dl>
      </div>
    </div>
    <!-- 其它 -->
    <div class="extra">
      <div class="container">
        <div class="slogan">
          <a href="javascript:">
            <i class="iconfont icon-footer01"></i>
            <span>价格亲民</span>
          </a>
          <a href="javascript:">
            <i class="iconfont icon-footer02"></i>
            <span>物流快捷</span>
          </a>
          <a href="javascript:">
            <i class="iconfont icon-footer03"></i>
            <span>品质新鲜</span>
          </a>
        </div>
        <!-- 版权信息 -->
        <div class="copyright">
          <p>
            <a href="javascript:">关于我们</a>
            <a href="javascript:">帮助中心</a>
            <a href="javascript:">售后服务</a>
            <a href="javascript:">配送与验收</a>
            <a href="javascript:">商务合作</a>
            <a href="javascript:">搜索推荐</a>
            <a href="javascript:">友情链接</a>
          </p>
          <p>CopyRight © 小兔鲜儿</p>
        </div>
      </div>
    </div>
  </footer>
</template>

<script>
export default {
  name: "AppFooter",
};
</script>

<style scoped lang="less">
.app-footer {
  overflow: hidden;
  background-color: #f5f5f5;
  padding-top: 20px;
  .contact {
    background: #fff;
    .container {
      padding: 60px 0 40px 25px;
      display: flex;
    }
    dl {
      height: 190px;
      text-align: center;
      padding: 0 72px;
      border-right: 1px solid #f2f2f2;
      color: #999;
      &:first-child {
        padding-left: 0;
      }
      &:last-child {
        border-right: none;
        padding-right: 0;
      }
    }
    dt {
      line-height: 1;
      font-size: 18px;
    }
    dd {
      margin: 36px 12px 0 0;
      float: left;
      width: 92px;
      height: 92px;
      padding-top: 10px;
      border: 1px solid #ededed;
      .iconfont {
        font-size: 36px;
        display: block;
        color: #666;
      }
      &:hover {
        .iconfont {
          color: @xtxColor;
        }
      }
      &:last-child {
        margin-right: 0;
      }
    }
    .qrcode {
      width: 92px;
      height: 92px;
      padding: 7px;
      border: 1px solid #ededed;
    }
    .download {
      padding-top: 5px;
      font-size: 14px;
      width: auto;
      height: auto;
      border: none;
      span {
        display: block;
      }
      a {
        display: block;
        line-height: 1;
        padding: 10px 25px;
        margin-top: 5px;
        color: #fff;
        border-radius: 2px;
        background-color: @xtxColor;
      }
    }
    .hotline {
      padding-top: 20px;
      font-size: 22px;
      color: #666;
      width: auto;
      height: auto;
      border: none;
      small {
        display: block;
        font-size: 15px;
        color: #999;
      }
    }
  }
  .extra {
    background-color: #333;
  }
  .slogan {
    height: 178px;
    line-height: 58px;
    padding: 60px 100px;
    border-bottom: 1px solid #434343;
    display: flex;
    justify-content: space-between;
    a {
      height: 58px;
      line-height: 58px;
      color: #fff;
      font-size: 28px;
      i {
        font-size: 50px;
        vertical-align: middle;
        margin-right: 10px;
        font-weight: 100;
      }
      span {
        vertical-align: middle;
        text-shadow: 0 0 1px #333;
      }
    }
  }
  .copyright {
    height: 170px;
    padding-top: 40px;
    text-align: center;
    color: #999;
    font-size: 15px;
    p {
      line-height: 1;
      margin-bottom: 20px;
    }
    a {
      color: #999;
      line-height: 1;
      padding: 0 10px;
      border-right: 1px solid #999;
      &:last-child {
        border-right: none;
      }
    }
  }
}
</style>
~~~

### 4. 抽取导航栏布局

思路：

- [x] 新建导航组件 `AppHeaderNav`, 拷贝组件所需结构和样式
- [x] 完成导航下拉菜单基础布局

------

第一步：将导航栏内容抽取出来，放到 `components/AppHeaderNav.vue` 组件中

~~~vue
<template>
  <ul class="app-header-nav">
    <li class="home">
      <RouterLink to="/">首页</RouterLink>
    </li>
    <li><a href="#">美食</a></li>
    <li><a href="#">餐厨</a></li>
    <li><a href="#">艺术</a></li>
    <li><a href="#">电器</a></li>
    <li><a href="#">居家</a></li>
    <li><a href="#">洗护</a></li>
    <li><a href="#">孕婴</a></li>
    <li><a href="#">服装</a></li>
    <li><a href="#">杂货</a></li>
  </ul>
</template>

<script>
export default {
  name: "AppHeaderNav",
};
</script>

<style scoped lang="less">
.app-header-nav {
  width: 820px;
  display: flex;
  justify-content: space-around;
  padding-left: 40px;
  position: relative;
  z-index: 998;

  > li {
    margin-right: 40px;
    width: 38px;
    text-align: center;

    > a {
      font-size: 16px;
      line-height: 32px;
      height: 32px;
      display: inline-block;
    }

    &:hover {
      > a {
        color: @xtxColor;
        border-bottom: 1px solid @xtxColor;
      }

      > .layer {
        height: 132px;
        opacity: 1;
      }
    }
  }
}
</style>
~~~

第二步：一级分类下的二级分类布局（与一级分类中的a标签同级）

~~~html
<div class="layer">
  <ul>
    <li v-for="i in 10" :key="i">
      <a href="#">
        <img src="http://zhoushugang.gitee.io/erabbit-client-pc-static/uploads/img/category%20(4).png" alt=""/>
        <p>果干</p>
      </a>
    </li>
  </ul>
</div>
~~~

样式

~~~vue
<style lang="less">
  .layer {
    width: 1240px;
    background-color: #fff;
    position: absolute;
    left: -200px;
    top: 56px;
    height: 0;
    overflow: hidden;
    opacity: 0;
    box-shadow: 0 0 5px #ccc;
    transition: all .2s .1s;
    ul {
      display: flex;
      flex-wrap: wrap;
      padding: 0 70px;
      align-items: center;
      height: 132px;
      li {
        width: 110px;
        text-align: center;
        img {
          width: 60px;
          height: 60px;
        }
        p {
          padding-top: 10px;
        }
        &:hover {
          p {
            color: @xtxColor;
          }
        }
      }
    }
  }
</style>
~~~

### 5. 导航栏数据填充

思路：

- [x] 创建用于向服务器端发送请求获取分类列表数据的 API 接口函数
- [x] 在 Vuex 中创建用于获取分类数据的 `action` 方法, 创建用于设置本地分类列表状态的 `mutation` 方法
- [x] 在 `AppLayout` 组件中触发 vuex 中的用于获取分类列表数据的 `action` 方法
- [x] 在 `AppHeaderNav` 组件中获取 vuex 中的分类列表数据并填充至模板
- [x] 准备一级分类静态数据并将其设置为 vuex 中分类列表数据的默认值

------

第一步：在 `src/api/category.js` 中创建获取分类列表数据的 API 接口函数

[首页-全部分类(包含推荐商品)](http://zhoushugang.gitee.io/erabbit-client-pc-document/api.html#u9996u9875-u5168u90e8u5206u7c7buff08u5305u542bu63a8u8350u5546u54c1uff090a3ca20id3du9996u9875-u5168u90e8u5206u7c7buff08u5305u542bu63a8u8350u5546u54c1uff093e203ca3e)

~~~js
import request from "@/utils/request";

/**
 * @typedef {object} Category - 分类对象
 * @property {string} id - 分类id
 * @property {string} name - 分类名称
 * @property {string} picture - 分类封面图片
 * @property {Category} children - 子级分类对象
 * @property {RecommendGoods} goods - 该分类下的推荐商品
 */

/**
 * @typedef {object} RecommendGoods 推荐商品
 * @property {string} id - 商品id
 * @property {string} name 商品名称
 * @property {string} desc 商品描述
 * @property {null | number} discount - 折扣信息
 * @property {number} orderNum - 销量
 * @property {string} picture - 商品图片
 * @property {string} price - 商品价格
 */

/**
 * 获取分类列表
 * @return {Promise<{result: Array<Category>}>}
 */
export function getCategoriesApi() {
  return request("/home/category/head", "get");
}
~~~

第二步：在 `src/store/category.js` 的`action`处调用 `getCategoriesApi` 方法，异步调用。

~~~js
import { getCategoriesApi } from "@/api/category";

export default {
  mutations: {
    /**
     * 设置分类列表数据
     * @param state
     * @param {Array<Category>} categories - 分类列表
     */
    setCategories(state, categories) {
      state.list = categories;
    },
  },
  actions: {
    /**
     * 向服务器端发送请求获取分类列表数据
     * @param commit
     * @return {Promise<void>}
     */
    async getCategories({ commit }) {
      // 发送请求获取数据
      const { result } = await getCategoriesApi();
      // 将数据存储在 vuex 中
      commit("setCategories", result);
    },
  },
}
~~~

第三步：在`LayoutTemplate`组件获取分类，因为有两处调用该方法，将其分开写会发送两次请求。

~~~js
import { useStore } from 'vuex'

export default {
  setup () {
    // 获取 store 对象
    const store = useStore()
    // 发送请求获取分类数据
    store.dispatch("category/getCategories");
  }
}
~~~

第四步：在`AppHeaderNav`组件中获取分类数据并填充至模板。

~~~js
import { useStore } from "vuex";

export default {
  name: "AppHeaderNav",
  setup() {
    // 获取 store 对象
    const store = useStore();
    // 获取分类模块状态
    const category = store.state.category;
    // 返回组件所需状态
    return { category };
  },
};
~~~

~~~html
<ul class="app-header-nav">
  <li class="home">
    <router-link to="/">首页</router-link>
  </li>
  <li v-for="item in category.list" :key="item.id">
    <a href="#">{{ item.name }}</a>
    <div class="layer">
      <ul>
        <li v-for="sub in item.children" :key="sub.id">
          <a href="#">
            <img :src="sub.picture" :alt="sub.name" />
            <p>{{ sub.name }}</p>
          </a>
        </li>
      </ul>
    </div>
  </li>
</ul>
~~~

第五步：因为异步请求需要时间的响应，所以当页面在加载时，我们只能看到导航栏出只有一个首页二字，这样的用户体验并不好，所以为了就解决这个问题，我们可以将导航栏数据设为静态资源，并将其传给Vuex。因为导航栏数据一般情况变化并不会很大。所以，做成静态并没有太大问题。

`api/category.js`

~~~js
// 一级分类
export const topCategories = [
  "居家",
  "美食",
  "服饰",
  "母婴",
  "个护",
  "严选",
  "数码",
  "运动",
  "杂货",
];
~~~

`store/category.js`

~~~js
import { topCategories } from "@/api/category";

export default {
  // 使用具有命名空间的 vuex 模块
  namespaced: true,
  state() {
    return {
      // 存储分类列表
      list: topCategories.map((item) => ({
        name: item,
      })),
    };
  }
}
~~~

### 6. 创建分类路由

思路：

- [x] 创建一级分类、二级分类页面组件
- [x] 配置一级分类路由及二级分类路由对应的路由规则
- [x] 在导航 `AppHeaderNav` 组件中添加路由跳转链接

------

首先，我们需要创建一级分类、二级分类页面组件。

`views/category/TopCategory.vue`

~~~vue
<template>
  <LayoutTemplate>
    <div>TopCategoryPage</div>
  </LayoutTemplate>
</template>

<script>
import LayoutTemplate from "@/views/LayoutTemplate.vue";
export default {
  components: { LayoutTemplate },
};
</script>

<style></style>
~~~

`views/category/SubCategory.vue`

~~~vue
<template>
  <LayoutTemplate>
    <div>SubCategoryPage</div>
  </LayoutTemplate>
</template>

<script>
import LayoutTemplate from "@/views/LayoutTemplate.vue";
export default {
  components: { LayoutTemplate },
};
</script>

<style></style>
~~~

第二步：在路由文件中配置该路由

`router/index.js`

~~~js
const TopCategoryPage = () =>
  import(
    /*webpackChunkName: 'TopCategoryPage'*/ "@/views/category/TopCategoryPage"
  );
const SubCategoryPage = () =>
  import(
    /*webpackChunkName: 'webpackChunkName'*/ "@/views/category/SubCategoryPage"
  );

const routes = [
  {
    path: "/category/:id",
    component: TopCategoryPage,
  },
  {
    path: "/category/sub/:id",
    component: SubCategoryPage,
  },
];
~~~

第三步：在`components/AppHeaderNav.vue`添加路由链接

~~~html
<!-- 一级路由链接 -->
<router-link :to="`/category/${item.id}`">{{ item.name }}</router-link>
<!-- 二级路由链接 -->
<router-link :to="`/category/sub/${sub.id}`"> ... </router-link>
~~~

### 7. 控制导航栏的下拉菜单显示和隐藏

思路：

- [x] 去除控制导航下拉菜单显示隐藏的 hover 样式代码
- [x] 编写 open 类名, 通过 JS 为元素添加或删除open类名来控制元素的显示和隐藏
- [x] 在 vuex 中为每一个一级分类数据添加 open 布尔值状态以控制是否显示导航下拉菜单
- [x] 在 vuex 中创建用于控制导航下拉菜单显示隐藏的方法 (修改布尔值数据)
- [x] 在组件中根据 open 布尔值状态为下拉菜单动态绑定控制其显示和隐藏的类名
- [x] 在组件中为元素添加事件最终实现导航下拉菜单的显示和隐藏

------

第一步：去除控制导航下拉菜单显示隐藏的 `hover` 样式代码

~~~less
.app-header-nav {
  > li {
    // 去除以下代码
    &:hover {
      > .layer {
        height: 132px;
        opacity: 1;
      }
    }
  }
}
~~~

第二步：在 `.layer` 下添加一个 `open` 类名用来控制显示和隐藏

~~~less
.layer {
  &.open {
   height: 132px;
   opacity: 1;
  }
}
~~~

第三步：在 `store/category.js` 下添加一个 `open` 布尔值状态以控制导航下拉菜单显示隐藏

~~~js
actions: {
    async getCategories({ commit }) {
      const { result } = await getCategoriesApi();
      result.forEach((element) => {
        element.open = false;
      });
      commit("setCategories", result);
    },
  },
~~~

第四步：在 `store/category.js` 中添加`open`和`close`方法用来控制 open 的布尔值状态。

~~~js
  mutations: {
    open(state, id) {
      const item = state.list.find((item) => item.id === id);
      item.open = true;
    },
    close(state, id) {
      const item = state.list.find((item) => item.id === id);
      item.open = false;
    },
  },
~~~

第五步：判断用户行为，在`mouseenter、mouseleave、click`的时候添加事件，并给 `.layer` 绑定open类

~~~vue
<template>
  <ul class="app-header-nav">
    <li class="home">
      <router-link to="/">首页</router-link>
    </li>
    <li
      @mouseenter="open(item.id)"
      @mouseleave="close(item.id)"
      @click="close(item.id)"
      v-for="item in category.list"
      :key="item.id"
    >
      <div class="layer" :class="{ open: item.open }"> ... </div>
    </li>
  </ul>
</template>

<script>
import { useStore } from "vuex";

export default {
  name: "AppHeaderNav",
  setup() {
    const open = (id) => {
      store.commit("category/open", id);
    };
    const close = (id) => {
      store.commit("category/close", id);
    };
    return {
      open,
      close,
    };
  },
};
</script>
~~~

### 8. 实现吸顶导航（手写实现）

思路：

- [x] 创建吸顶导航组件 `AppHeaderSticky`, 完成基础布局
- [x] 在 `AppLayout` 组件中调用吸顶导航组件
- [x] 为吸顶导航组件添加样式, 让它在默认情况下隐藏
- [x] 封装一个通用的获取滚动距离的方法 `useScrollTop`
- [x] 在组件中调用 `useScrollTop` 方法获取滚动距离, 根据滚动距离控制吸顶导航的显示和隐藏

------

第一步：创建吸顶导航栏布局`components/AppHeaderSticky.vue`

~~~vue
<template>
  <div class="app-header-sticky">
    <div class="container">
      <RouterLink to="/" class="logo" />
      <AppHeaderNav />
      <div class="right">
        <RouterLink to="/">品牌</RouterLink>
        <RouterLink to="/">专题</RouterLink>
      </div>
    </div>
  </div>
</template>

<script>
import AppHeaderNav from "@/components/AppHeaderNav";
export default {
  name: "AppHeaderSticky",
  components: { AppHeaderNav },
};
</script>

<style scoped lang="less">
.app-header-sticky {
  width: 100%;
  height: 80px;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 999;
  background-color: #fff;
  border-bottom: 1px solid #e4e4e4;
  .container {
    display: flex;
    align-items: center;
  }
  .logo {
    width: 200px;
    height: 80px;
    background: url(../assets/images/logo.png) no-repeat right 2px;
    background-size: 160px auto;
  }
  .right {
    width: 220px;
    display: flex;
    text-align: center;
    padding-left: 40px;
    border-left: 2px solid @xtxColor;
    a {
      width: 38px;
      margin-right: 40px;
      font-size: 16px;
      line-height: 1;
      &:hover {
        color: @xtxColor;
      }
    }
  }
}
</style>
~~~

第二步：放入`views/LayoutTemplate.vue`

~~~vue
<template>
  <AppHeader />
  <AppHeaderSticky />
</template>
<script>
import AppHeaderSticky from "@/components/AppHeaderSticky";
export default {
  components: { AppHeaderSticky },
}
</script>
~~~

第三步：给吸顶导航过渡动画

~~~css
.app-header-sticky {
  transition: translateY(-100%);
  opacity: 0;
}
~~~

第四步：获取window自带的scroll滚动事件，并将其封装为：`hooks/useScrollTop.js`

~~~js
import { ref, onMounted, onUnmounted } from "vue";

// TODO: useScrollTop
export default function useScrollTop() {
  // 存储滚动条的位置
  const scrollTop = ref(0);
  // 滚动事件处理函数
  const onScrollHandler = () => {
    scrollTop.value =
      document.documentElement.scrollTop || document.body.scrollTop;
  };
  // 组件初始化时，绑定滚动事件
  onMounted(() => {
    // 绑定滚动事件
    window.addEventListener("scroll", onScrollHandler);
  });
  // 组件销毁时，解绑滚动事件
  onUnmounted(() => {
    // 解绑滚动事件
    window.removeEventListener("scroll", onScrollHandler);
  });

  // 返回滚动条的位置
  return scrollTop;
}
~~~

第五步：在 `AppHeaderSticky.vue` 中调用该方法

~~~vue
<script>
import AppHeaderNav from "@/components/AppHeaderNav";
// 引入封装的滚动事件
import useScrollTop from "@/hooks/useScrollTop";
export default {
  name: "AppHeaderSticky",
  components: { AppHeaderNav },
  setup() {
    return { scrollTop: useScrollTop() };
  },
};
</script>
~~~

第六步：判断在什么高度的时候显示吸顶导航栏

~~~html
  <div class="app-header-sticky" :class="{ show: scrollTop > 78 }"> ... </div>
~~~

第七步：问题：当我们实现后会发现，当鼠标放入一级分类后显示出了二级分类，但是我们把鼠标往上移动，会发现二级分类并未消失。这是因为吸顶导航栏的样式`transition: translateY(-100%);opacity: 0;`只是让其往上移动了，并且覆盖了上面的内容，所以我们需要进行判断，当期到达一定的高度时，在让其显示，没有则隐藏;使用`v-show`

~~~html
<div class="container" v-show="scrollTop > 78"> ... </div>
~~~

### 9. 实现吸顶导航（工具库实现）

思路：

- [x] 使用工具库提供的 `useWindowScroll` 方法获取页面滚动距离

------

第一步：安装`npm install @vueuse/core@6.1.0`

~~~powershell
npm install @vueuse/core@6.1.0
~~~

第二步：直接在对应的文件中调用 `useWindowScroll` 

~~~vue
<template>
  <div class="app-header-sticky" :class="{ show: scrollTop > 78 }">
    <div class="container" v-show="scrollTop > 78">
      <RouterLink to="/" class="logo" />
      <AppHeaderNav />
      <div class="right">
        <RouterLink to="/">品牌</RouterLink>
        <RouterLink to="/">专题</RouterLink>
      </div>
    </div>
  </div>
</template>

<script>
import AppHeaderNav from "@/components/AppHeaderNav";
// 工具库实现滚动事件
import { useWindowScroll } from "@vueuse/core";
export default {
  name: "AppHeaderSticky",
  components: { AppHeaderNav },
  setup() {
    const { y: scrollTop } = useWindowScroll();
    return { scrollTop };
  },
};
</script>

<style scoped lang="less">
.app-header-sticky {
  width: 100%;
  height: 80px;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 999;
  background-color: #fff;
  border-bottom: 1px solid #e4e4e4;
  transition: translateY(-100%);
  opacity: 0;

  &.show {
    transform: none;
    opacity: 1;
    transition: all 0.3s linear;
  }

  .container {
    display: flex;
    align-items: center;
  }

  .logo {
    width: 200px;
    height: 80px;
    background: url(../assets/images/logo.png) no-repeat right 2px;
    background-size: 160px auto;
  }

  .right {
    width: 220px;
    display: flex;
    text-align: center;
    padding-left: 40px;
    border-left: 2px solid @xtxColor;

    a {
      width: 38px;
      margin-right: 40px;
      font-size: 16px;
      line-height: 1;

      &:hover {
        color: @xtxColor;
      }
    }
  }
}
</style>
~~~

### 10. 左侧分类结构渲染

思路：

- [x] 创建首页左侧分类列表组件, 实现基础布局
- [x] 在首页页面组件中调用左侧分类列表组件
- [x] 根据分类列表数据计算出新的左侧分类列表组件所需要的数据
- [x] 渲染新的分类列表数据至模板
- [x] 将计算左侧分类列表的逻辑抽取成单独的方法

------

第一步：创建 `src/views/home/components/HomeCategory.vue`，并实现布局页面

~~~vue
<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="i in 10" :key="i">
        <RouterLink to="/">居家</RouterLink>
        <RouterLink to="/">洗漱</RouterLink>
        <RouterLink to="/">清洁</RouterLink>
      </li>
    </ul>
  </div>
</template>

<script>
export default {
  name: "HomeCategory",
};
</script>
<style scoped lang="less">
.home-category {
  width: 250px;
  height: 500px;
  background: rgba(0, 0, 0, 0.8);
  position: relative;
  z-index: 99;
  .menu {
    li {
      padding-left: 40px;
      height: 50px;
      line-height: 50px;
      &:hover {
        background-color: @xtxColor;
      }
      a {
        margin-right: 4px;
        color: #fff;
        &:first-child {
          font-size: 16px;
        }
      }
    }
  }
}
</style>
~~~

第二步：引入到`HomePage.vue`

~~~vue
<template>
  <LayoutTemplate>
    <div class="container">
      <HomeCategory />
    </div>
  </LayoutTemplate>
</template>

<script>
import LayoutTemplate from "@/views/LayoutTemplate.vue";
import HomeCategory from "@/views/home/components/HomeCategory.vue";
export default {
  components: {
    LayoutTemplate,
    HomeCategory,
  },
  name: "HomePage",
};
</script>
~~~

第三步：获取`store/category` 中的 list 数据，并且根据要求，我们需要的children数量为2，需要进行条件判断截取 2 条数据

~~~js
<script>
import { computed, ref } from "@vue/reactivity";
import { useStore } from "vuex";

export default {
  name: "HomeCategory",
  setup() {
    const store = useStore();
    // 分类数据
    const category = computed(() => {
      // 获取分类数据,并便利
      const list = store.state.category.list.map((item) => ({
        ...item,
        // 分类下的子分类，我们只需要2个数据
        children: item.children ? item.children.slice(0, 2) : [],
      }));
      // 返回 list
      return list;
    });
    return {
      category,
    };
  },
};
</script>
~~~

第四步：进行模板渲染，并且书写路由链接

~~~html
<ul class="menu">
  <li v-for="item in category" :key="item.id">
    <router-link :to="`/category/${item.id}`">{{ item.name }}</router-link>
    <router-link
      v-for="sub in item.children"
      :key="sub.id"
      :to="`/category/sub/${sub.id}`"
      >{{ sub.name }}</router-link
    >
  </li>
</ul>
~~~

第五步：我们会发现，底部和设计表中少了一条数据，所以我们需要添加一条品牌的数据

~~~js
// 品牌数据
const brand = ref({
  name: "品牌",
  id: "brand",
  children: [{ name: "品牌推荐", id: "brand-recommend" }],
  brands: [],
});
// 分类数据
const category = computed(() => {
  ...
  // 将品牌数据插入到分类数据
  list.push(brand.value);
  return list;
});
~~~

第六步：将其抽取为单独的逻辑

~~~js
/** 将左侧列表抽取成单独的逻辑
 * returns {Array}
 */
function useMenuList() {
  const store = useStore();
  // 品牌数据
  const brand = ref({
    name: "品牌",
    id: "brand",
    children: [{ name: "品牌推荐", id: "brand-recommend" }],
    brands: [],
  });
  // 分类数据
  const category = computed(() => {
    // 获取分类数据,并便利
    const list = store.state.category.list.map((item) => ({
      ...item,
      // 分类下的子分类，我们只需要2个数据
      children: item.children ? item.children.slice(0, 2) : [],
    }));
    // 将品牌数据插入到分类数据
    list.push(brand.value);
    // 返回 list
    return list;
  });

  return category;
}
~~~

第七步：调用该方法

~~~js
setup() {
    return {
      menuList: useMenuList(),
    };
  },
~~~

### 11. 实现左侧分类列表商品推荐